<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run | Tim Engle Blog</title>
<meta name=keywords content><meta name=description content="The references to a blog in this post are for my older blog that was built from
scratch using Go. My new blog is built using Hugo and the Papermod.
In the previous post, we created our GitHub Actions workflow, build script, and Dockerfile. In this post, we will focus on setting up GCP and enabling the APIs that allow our workflow to automate each step of the deployment process.
Here’s what we’ll cover:"><meta name=author content="Tim Engle"><link rel=canonical href=http://localhost:1313/posts/gcp-continuous-deployment-3/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/gcp-continuous-deployment-3/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/gcp-continuous-deployment-3/"><meta property="og:site_name" content="Tim Engle Blog"><meta property="og:title" content="Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run"><meta property="og:description" content="The references to a blog in this post are for my older blog that was built from scratch using Go. My new blog is built using Hugo and the Papermod.
In the previous post, we created our GitHub Actions workflow, build script, and Dockerfile. In this post, we will focus on setting up GCP and enabling the APIs that allow our workflow to automate each step of the deployment process.
Here’s what we’ll cover:"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-26T17:47:11-08:00"><meta property="article:modified_time" content="2024-08-26T17:47:11-08:00"><meta property="og:image" content="http://localhost:1313/img/card.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/img/card.webp"><meta name=twitter:title content="Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run"><meta name=twitter:description content="The references to a blog in this post are for my older blog that was built from
scratch using Go. My new blog is built using Hugo and the Papermod.
In the previous post, we created our GitHub Actions workflow, build script, and Dockerfile. In this post, we will focus on setting up GCP and enabling the APIs that allow our workflow to automate each step of the deployment process.
Here’s what we’ll cover:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run","item":"http://localhost:1313/posts/gcp-continuous-deployment-3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run","name":"Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run","description":"The references to a blog in this post are for my older blog that was built from scratch using Go. My new blog is built using Hugo and the Papermod.\nIn the previous post, we created our GitHub Actions workflow, build script, and Dockerfile. In this post, we will focus on setting up GCP and enabling the APIs that allow our workflow to automate each step of the deployment process.\nHere’s what we’ll cover:\n","keywords":[],"articleBody":"The references to a blog in this post are for my older blog that was built from scratch using Go. My new blog is built using Hugo and the Papermod.\nIn the previous post, we created our GitHub Actions workflow, build script, and Dockerfile. In this post, we will focus on setting up GCP and enabling the APIs that allow our workflow to automate each step of the deployment process.\nHere’s what we’ll cover:\nSetting up a GCP account and project Creating and configuring a service account for GitHub workflow access Building and pushing Docker images to Artifact Registry Preparing the Cloud Run API for automatic container deployment By the end of this post we will have a fully automated pipeline which will deploy new containers to GCP whenever updates are pushed to our main branch of our repository.\nCreating a GCP Account \u0026 Project Creating an account Creating a GCP account is pretty straight forward. You just need to follow the sign up process. Starting account activates a free year long trial which you should be able to use to finish this series of posts.\nCreating a project Once your account is created you will want to start your first project. Give your project a name that will be easy to remember, I will name mine timengledev, and then we will be ready to move on to create a service account.\nBefore continuing, we will also need to set up a billing account to verify ourself with GCP. Don’t worry—you should stay within the free tier if you follow the instructions in this series.\nNow that our GCP account is set up we are ready to start enabling the services we need in order to store, host, and deploy Docker images and containers.\nCreating an Artifact Registry We will be using Google Artifact Registry to store our Docker images. Google Artifact Registry is similar to Docker Hub, but it is private and hosted by GCP. Our goal is to create and push a new Docker image to the Artifact Registry whenever a new version of our Go application is pushed to our main branch.\nEnabling the Artifact Registry Head to the Artifact Registry using the search input in the GCP console and enable the API. Create a new repository. I used the following settings Name: app Format: Docker Mode: Standard Location Type: Region Region For Deployment: us-west1 Left ‘Google-managed encryption key’ checked Great now our Artifact Registry is set up for our project and we can continue on to create a Service Account so we can automate this build process in our GitHub Action workflow.\nCreating a Service Account To gain access to our GCP project we will want to set up and create a key for a Service Account. We can follow these instructions to create a JSON key which we can use as a GitHub Secret to gain access to our GCP account in our workflow.\nHead to the IAM \u0026 Service Accounts and select the current project you are working with. At the top of the console click ‘Create Service Account’. Create a Service Account (I named mine timengleblog_cloud) and enable these permissions. Cloud Build Editor Cloud Build Service Account Cloud Run Admin Service Account User Viewer Click the actions ellipsis next to the account you just created Click Manage keys You will be taken to a new page where you can click “ADD KEY” and select “Create new key” and select JSON The key will download Great we now have the credentials to begin automating our CD pipeline within our workflow.\nAccessing GCP Within our Workflow We can begin to access our GCP account in our workflow by adding a new step that uses this google-github-actions which will set up and configure, gcloud the cli tool used to access and make changes to our project via our service worker.\nAdding our JSON key We will head to the GitHub repository for our project and navigate to Settings -\u003e Secrets and Variables -\u003e Actions Then copy the contents of the JSON file which contains the GCP service account key. We will now create a new secret called GCP_CREDENTIALS by clicking ‘New repository secret’.\nGreat now that we have added our credentials of our service worker we are ready to access GCP within our workflow.\nAdding a step to authenticate GCP To allow our workflow to interact with the Google Cloud we need to authenticate the workflow using the secret we added to our repository in the previous step. This will be done using setup-cloud action which will configure the gcloud CLI in our workflow. We will add this step following our step that runs our script responsible for building our application binary.\n# Authenticate with Google Cloud - id: auth uses: google-github-actions/auth@v2 with: credentials_json: ${{ secrets.GCP_CREDENTIALS }} # Set up the Google Cloud SDK - name: Setup GCP SDK uses: google-github-actions/setup-gcloud@v2 These steps will allow us to access the Artifact Registry API and begin building and pushing our Docker Images to the cloud.\nBuilding and Pushing our Updated Docker Image We are now able to build and push our Docker images to our Artifact Registry with each push to the main branch of our repository. We just need to add a step that will build our Docker image that includes our updated binary. We will accomplish this by running our Dockerfile. Below is the gcloudcommand that we will use to do this.\ngcloud builds submit --tag REGION-docker.pkg.dev/PROJECT_ID/REPOSITORY/IMAGE:TAG . This command builds, tags, and pushes our Docker Image. We will need to insert the correct information for the URL to push our Image to the correct Artifact Registry location. You can enter this manual or you can head to the Artifact Registry in the console, click on the name you gave your Artifact Registry and copy the url.\nGreat, now that you have located the URL for your Artifact Registry we are ready to add the step to build and push our updated Image.\nAdding Build and Push Step After the steps that authenticate our workflow to use gcloud tool we can add our step to build and push our Docker Image.\non: push: branches: [main] jobs: deploy: name: Deploy runs-on: ubuntu-latest steps: # Checkout the repository code - name: Checkout code uses: actions/checkout@v4 # Set up Go environment - name: Setup Go uses: actions/setup-go@v5 with: go-version: \"1.22.1\" # Build the production binary - name: Build Binary run: ./scripts/buildprod.sh # Authenticate with Google Cloud - id: auth uses: google-github-actions/auth@v2 with: credentials_json: ${{ secrets.GCP_CREDENTIALS }} # Set up the Google Cloud SDK - name: Setup GCP SDK uses: google-github-actions/setup-gcloud@v2 # Verify gcloud CLI setup - name: Use gcloud cli run: gcloud info # Build and push the Docker image to Artifact Registry - name: Build \u0026 Push image to Artifact Registry run: | gcloud builds submit \\ --tag us-west1-docker.pkg.dev/timengledev-blog/app/timengledev-blog:latest . Now is a great time to push our updates to our GitHub repository and create a Pull Request into main. Once we accept the Pull Request our Workflow will begin running, you can view it’s progress in the Actions tab of your repository. Once completed we should have a copy of our most up to date Docker Image stored within our Artifact Registry.\nGreat job!! We are now ready to begin setting up Cloud Run to deploy our Docker Image.\nSetting up Cloud Run Now that our Docker Images are hosted on the Google Cloud using Artifact Registry we need a way to deploy, host, and scale them. The Cloud Run API can do just that for us, so we need to set it up within our project so we can access it within our workflow and start deploying our most up to date version of our Docker Containers.\nCreating our Cloud Run Service Head to the Cloud Run in the console. Click “Create Service” Select A Container Image URL Click “Select” Click on the URL that matches our Artifact Registry Select Latest Give it a service name. I named mine timengledev Select an appropriate region Check “Allow unauthenticated invocations”. This will allow anyone to access our service without having to log into GCP. Open the Container(s), Volumes, Networking, Security tab Scroll down and select the Max number of instances. I selected 4 Cloud Run scales based on traffic, and if traffic grows becomes larger than our 4 containers can handle, requests will begin to be queued. You are welcome to set your max instances higher, but be aware as your traffic grows you will be charged more as the number of containers hosted at the same time grows. For Ingress control select “All”. This will allow direct access to our service Create your service. Once it has deployed you can click the link and see your service hosted! Now that our Cloud Run service is all set up and hosting containers we can head back to our workflow and add a step which will automatically host our most up to date Images from our Artifact Registry when a push to the main branch occurs.\nDeploying our Updated Container The final step of our workflow is to configure Cloud Run with the correct image and deployment region. We’ll use the gcloud CLI tool to point Cloud Run to the right project and Docker image, while also specifying settings like the max-instances and region for deployment.\nWe will need to run the following gcloud command in our final step to deploy our updated container using Cloud Run.\ngcloud run deploy CLOUD_RUN_NAME \\ --image REGION-docker.pkg.dev/PROJECT_ID/REPOSITORY/IMAGE:TAG \\ --region REGION \\ --allow-unauthenticated \\ --project PROJECT_NAME \\ --max-instances=4 Complete workflow Now putting it all together I have a complete CD pipeline that is fully automated using a GitHub Action workflow that looks like this.\non: push: branches: [main] jobs: deploy: name: Deploy runs-on: ubuntu-latest steps: # Checkout the repository code - name: Checkout code uses: actions/checkout@v4 # Set up Go environment - name: Setup Go uses: actions/setup-go@v5 with: go-version: \"1.22.1\" # Build the production binary - name: Build Binary run: ./scripts/buildprod.sh # Authenticate with Google Cloud - id: auth uses: google-github-actions/auth@v2 with: credentials_json: ${{ secrets.GCP_CREDENTIALS }} # Set up the Google Cloud SDK - name: Setup GCP SDK uses: google-github-actions/setup-gcloud@v2 # Verify gcloud CLI setup - name: Use gcloud cli run: gcloud info # Build and push the Docker image to Artifact Registry - name: Build \u0026 Push image to Artifact Registry run: | gcloud builds submit \\ --tag us-west1-docker.pkg.dev/timengledev-blog/app/timengledev-blog:latest . # Deploy the container image to Cloud Run - name: Deploy to Cloud Run run: | gcloud run deploy timengledev-blog \\ --image us-west1-docker.pkg.dev/timengledev-blog/app/timengledev-blog:latest \\ --region us-west1 \\ --allow-unauthenticated \\ --project timengledev-blog \\ --max-instances=4 When ever updates are pushed to the main branch the following will happen.\nAn instance of the latest ubuntu will be spun up on a remote machine. The code from the main branch will be checked out into this machine. Go will be set up. The build script created in he previous section will execute and create our binary that runs the application. The machine will be authenticated with GCP using our Service Account. gcloud will be set up and run A new Image containing the updated binary will be built and pushed to the Artifact Registry Cloud Run will deploy an updated container using the updated image that was just built and pushed to the Artifact Registry. Conclusion Now that we have a fully automated CD pipeline in place we will have more time free to focus on creating new features and fixing bugs. We will no longer need to manually build, upload, and deploy production code manually to GCP as all of this will be handled by our pipeline.\nIn the future we will look into monitoring containers, optimizing performance, and scaling as applications grow. This is just the beginning of creating a robust, scalable, and automated infrastructure for your Go containers.\n","wordCount":"1975","inLanguage":"en","image":"http://localhost:1313/img/card.webp","datePublished":"2024-08-26T17:47:11-08:00","dateModified":"2024-08-26T17:47:11-08:00","author":{"@type":"Person","name":"Tim Engle"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/gcp-continuous-deployment-3/"},"publisher":{"@type":"Organization","name":"Tim Engle Blog","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Home (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run</h1><div class=post-meta><span title='2024-08-26 17:47:11 -0800 -0800'>August 26, 2024</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;1975 words&nbsp;·&nbsp;Tim Engle</div></header><div class=post-content><p><em>The references to a blog in this post are for my older blog that was built from
scratch using Go. My new blog is built using Hugo and the Papermod.</em></p><p>In the <a href=https://timengle.dev/posts/view/Continuous++Deployment%3A+Creating+a+GitHub+Workflow%2C+Build+Script%2C+and+Dockerfile>previous post</a>, we created our GitHub Actions workflow, build script, and Dockerfile. In this post, we will focus on setting up GCP and enabling the APIs that allow our workflow to automate each step of the deployment process.</p><p>Here’s what we’ll cover:</p><ul><li>Setting up a GCP account and project</li><li>Creating and configuring a service account for GitHub workflow access</li><li>Building and pushing Docker images to Artifact Registry</li><li>Preparing the Cloud Run API for automatic container deployment</li></ul><p>By the end of this post we will have a fully automated pipeline which will deploy new containers to GCP whenever updates are pushed to our <code>main</code> branch of our repository.</p><hr><h2 id=creating-a-gcp-account--project>Creating a GCP Account & Project<a hidden class=anchor aria-hidden=true href=#creating-a-gcp-account--project>#</a></h2><h3 id=creating-an-account>Creating an account<a hidden class=anchor aria-hidden=true href=#creating-an-account>#</a></h3><p>Creating a GCP account is pretty straight forward. You just need to follow the <a href="https://cloud.google.com/?hl=en">sign up process</a>. Starting account activates a free year long trial which you should be able to use to finish this series of posts.</p><h3 id=creating-a-project>Creating a project<a hidden class=anchor aria-hidden=true href=#creating-a-project>#</a></h3><p>Once your account is created you will want to <a href=https://developers.google.com/workspace/guides/create-project>start your first project</a>. Give your project a name that will be easy to remember, I will name mine <code>timengledev</code>, and then we will be ready to move on to create a service account.</p><p>Before continuing, we will also need to <a href=https://cloud.google.com/billing/docs/how-to/create-billing-account>set up a billing account</a> to verify ourself with GCP. Don’t worry—you should stay within the free tier if you follow the instructions in this series.</p><p>Now that our GCP account is set up we are ready to start enabling the services we need in order to store, host, and deploy Docker images and containers.</p><hr><h2 id=creating-an-artifact-registry>Creating an Artifact Registry<a hidden class=anchor aria-hidden=true href=#creating-an-artifact-registry>#</a></h2><p>We will be using Google Artifact Registry to store our Docker images. Google Artifact Registry is similar to Docker Hub, but it is private and hosted by GCP. Our goal is to create and push a new Docker image to the Artifact Registry whenever a new version of our Go application is pushed to our <code>main</code> branch.</p><h3 id=enabling-the-artifact-registry>Enabling the Artifact Registry<a hidden class=anchor aria-hidden=true href=#enabling-the-artifact-registry>#</a></h3><ol><li>Head to the Artifact Registry using the search input in the GCP console and enable the API.</li><li>Create a new repository. I used the following settings</li></ol><ul><li>Name: <code>app</code></li><li>Format: <code>Docker</code></li><li>Mode: <code>Standard</code></li><li>Location Type: <code>Region</code></li><li>Region For Deployment: <code>us-west1</code></li><li>Left &lsquo;Google-managed encryption key&rsquo; checked</li></ul><p>Great now our Artifact Registry is set up for our project and we can continue on to create a Service Account so we can automate this build process in our GitHub Action workflow.</p><hr><h2 id=creating-a-service-account>Creating a Service Account<a hidden class=anchor aria-hidden=true href=#creating-a-service-account>#</a></h2><p>To gain access to our GCP project we will want to set up and create a key for a Service Account. We can follow these instructions to create a JSON key which we can use as a GitHub Secret to gain access to our GCP account in our workflow.</p><ol><li>Head to the <a href=https://console.cloud.google.com/iam-admin/serviceaccounts>IAM & Service Accounts</a> and select the current project you are working with.</li><li>At the top of the console click &lsquo;Create Service Account&rsquo;.</li><li>Create a Service Account (I named mine <code>timengleblog_cloud</code>) and enable these permissions.</li></ol><ul><li><code>Cloud Build Editor</code></li><li><code>Cloud Build Service Account</code></li><li><code>Cloud Run Admin</code></li><li><code>Service Account User</code></li><li><code>Viewer</code></li></ul><ol start=4><li>Click the actions ellipsis next to the account you just created</li><li>Click Manage keys</li><li>You will be taken to a new page where you can click &ldquo;ADD KEY&rdquo; and select &ldquo;Create new key&rdquo; and select <code>JSON</code></li><li>The key will download</li></ol><p>Great we now have the credentials to begin automating our CD pipeline within our workflow.</p><hr><h2 id=accessing-gcp-within-our-workflow>Accessing GCP Within our Workflow<a hidden class=anchor aria-hidden=true href=#accessing-gcp-within-our-workflow>#</a></h2><p>We can begin to access our GCP account in our workflow by adding a new step that uses this <a href=https://github.com/google-github-actions/setup-gcloud>google-github-actions</a> which will set up and configure, <code>gcloud</code> the cli tool used to access and make changes to our project via our service worker.</p><h3 id=adding-our-json-key>Adding our JSON key<a hidden class=anchor aria-hidden=true href=#adding-our-json-key>#</a></h3><p>We will head to the GitHub repository for our project and navigate to
<code>Settings -> Secrets and Variables -> Actions</code>
Then copy the contents of the JSON file which contains the GCP service account key.
We will now create a new secret called <code>GCP_CREDENTIALS</code> by clicking &lsquo;New repository secret&rsquo;.</p><p>Great now that we have added our credentials of our service worker we are ready to access GCP within our workflow.</p><h3 id=adding-a-step-to-authenticate-gcp>Adding a step to authenticate GCP<a hidden class=anchor aria-hidden=true href=#adding-a-step-to-authenticate-gcp>#</a></h3><p>To allow our workflow to interact with the Google Cloud we need to authenticate the workflow using the secret we added to our repository in the previous step. This will be done using <a href=https://github.com/google-github-actions/setup-gcloud>setup-cloud action</a> which will configure the <code>gcloud</code> CLI in our workflow. We will add this step following our step that runs our script responsible for building our application binary.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># Authenticate with Google Cloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>google-github-actions/auth@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>credentials_json</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GCP_CREDENTIALS }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># Set up the Google Cloud SDK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup GCP SDK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>google-github-actions/setup-gcloud@v2</span><span class=w>
</span></span></span></code></pre></div><p>These steps will allow us to access the Artifact Registry API and begin building and pushing our Docker Images to the cloud.</p><hr><h2 id=building-and-pushing-our-updated-docker-image>Building and Pushing our Updated Docker Image<a hidden class=anchor aria-hidden=true href=#building-and-pushing-our-updated-docker-image>#</a></h2><p>We are now able to build and push our Docker images to our Artifact Registry with each push to the <code>main</code> branch of our repository. We just need to add a step that will build our Docker image that includes our updated binary. We will accomplish this by running our Dockerfile. Below is the <code>gcloud</code>command that we will use to do this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud builds submit --tag REGION-docker.pkg.dev/PROJECT_ID/REPOSITORY/IMAGE:TAG .
</span></span></code></pre></div><p>This command builds, tags, and pushes our Docker Image. We will need to insert the correct information for the URL to push our Image to the correct Artifact Registry location. You can enter this manual or you can head to the Artifact Registry in the console, click on the name you gave your Artifact Registry and copy the url.</p><p><img alt="Image of url clipboard icon location" loading=lazy src=https://storage.googleapis.com/timengledev-blog-bucket/static/dist/blog_img/2024_08_26/20240825090020.png></p><p>Great, now that you have located the URL for your Artifact Registry we are ready to add the step to build and push our updated Image.</p><h3 id=adding-build-and-push-step>Adding Build and Push Step<a hidden class=anchor aria-hidden=true href=#adding-build-and-push-step>#</a></h3><p>After the steps that authenticate our workflow to use <code>gcloud</code> tool we can add our step to build and push our Docker Image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Checkout the repository code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Set up Go environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-go@v5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>go-version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.22.1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Build the production binary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Binary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./scripts/buildprod.sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Authenticate with Google Cloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>google-github-actions/auth@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>credentials_json</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GCP_CREDENTIALS }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Set up the Google Cloud SDK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup GCP SDK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>google-github-actions/setup-gcloud@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Verify gcloud CLI setup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Use gcloud cli</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>gcloud info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Build and push the Docker image to Artifact Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build &amp; Push image to Artifact Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          gcloud builds submit \
</span></span></span><span class=line><span class=cl><span class=sd>            --tag us-west1-docker.pkg.dev/timengledev-blog/app/timengledev-blog:latest .</span><span class=w>          
</span></span></span></code></pre></div><p>Now is a great time to push our updates to our GitHub repository and create a Pull Request into main. Once we accept the Pull Request our Workflow will begin running, you can view it&rsquo;s progress in the Actions tab of your repository. Once completed we should have a copy of our most up to date Docker Image stored within our Artifact Registry.</p><p>Great job!! We are now ready to begin setting up Cloud Run to deploy our Docker Image.</p><hr><h2 id=setting-up-cloud-run>Setting up Cloud Run<a hidden class=anchor aria-hidden=true href=#setting-up-cloud-run>#</a></h2><p>Now that our Docker Images are hosted on the Google Cloud using Artifact Registry we need a way to deploy, host, and scale them. The <a href=https://cloud.google.com/run/>Cloud Run API</a> can do just that for us, so we need to set it up within our project so we can access it within our workflow and start deploying our most up to date version of our Docker Containers.</p><h3 id=creating-our-cloud-run-service>Creating our Cloud Run Service<a hidden class=anchor aria-hidden=true href=#creating-our-cloud-run-service>#</a></h3><ol><li>Head to the <a href=https://console.cloud.google.com/run>Cloud Run</a> in the console.</li><li>Click &ldquo;Create Service&rdquo;</li><li>Select A Container Image URL</li></ol><ul><li>Click &ldquo;Select&rdquo;</li><li>Click on the URL that matches our Artifact Registry</li><li>Select Latest</li></ul><ol start=4><li>Give it a service name. I named mine <code>timengledev</code></li><li>Select an appropriate region</li><li>Check &ldquo;Allow unauthenticated invocations&rdquo;. This will allow anyone to access our service without having to log into GCP.</li><li>Open the <code>Container(s), Volumes, Networking, Security</code> tab</li></ol><ul><li>Scroll down and select the Max number of instances.</li><li>I selected <code>4</code></li><li>Cloud Run scales based on traffic, and if traffic grows becomes larger than our 4 containers can handle, requests will begin to be queued. You are welcome to set your max instances higher, but be aware as your traffic grows you will be charged more as the number of containers hosted at the same time grows.</li></ul><ol start=8><li>For Ingress control select &ldquo;All&rdquo;. This will allow direct access to our service</li><li>Create your service.</li><li>Once it has deployed you can click the link and see your service hosted!</li></ol><p>Now that our Cloud Run service is all set up and hosting containers we can head back to our workflow and add a step which will automatically host our most up to date Images from our Artifact Registry when a push to the <code>main</code> branch occurs.</p><hr><h2 id=deploying-our-updated-container>Deploying our Updated Container<a hidden class=anchor aria-hidden=true href=#deploying-our-updated-container>#</a></h2><p>The final step of our workflow is to configure Cloud Run with the correct image and deployment region. We’ll use the <code>gcloud</code> CLI tool to point Cloud Run to the right project and Docker image, while also specifying settings like the <code>max-instances</code> and region for deployment.</p><p>We will need to run the following <code>gcloud</code> command in our final step to deploy our updated container using Cloud Run.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gcloud run deploy CLOUD_RUN_NAME <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> --image REGION-docker.pkg.dev/PROJECT_ID/REPOSITORY/IMAGE:TAG <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    --region REGION <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> --allow-unauthenticated <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> --project PROJECT_NAME <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> --max-instances<span class=o>=</span><span class=m>4</span>
</span></span></code></pre></div><h3 id=complete-workflow>Complete workflow<a hidden class=anchor aria-hidden=true href=#complete-workflow>#</a></h3><p>Now putting it all together I have a complete CD pipeline that is fully automated using a GitHub Action workflow that looks like this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=l>main]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Checkout the repository code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout code</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Set up Go environment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Go</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-go@v5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>go-version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.22.1&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Build the production binary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Binary</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>./scripts/buildprod.sh</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Authenticate with Google Cloud</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>auth</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>google-github-actions/auth@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>credentials_json</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GCP_CREDENTIALS }}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Set up the Google Cloud SDK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup GCP SDK</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>google-github-actions/setup-gcloud@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Verify gcloud CLI setup</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Use gcloud cli</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>gcloud info</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Build and push the Docker image to Artifact Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build &amp; Push image to Artifact Registry</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          gcloud builds submit \
</span></span></span><span class=line><span class=cl><span class=sd>            --tag us-west1-docker.pkg.dev/timengledev-blog/app/timengledev-blog:latest .</span><span class=w>          
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c># Deploy the container image to Cloud Run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy to Cloud Run</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          gcloud run deploy timengledev-blog \
</span></span></span><span class=line><span class=cl><span class=sd>            --image us-west1-docker.pkg.dev/timengledev-blog/app/timengledev-blog:latest \
</span></span></span><span class=line><span class=cl><span class=sd>            --region us-west1 \
</span></span></span><span class=line><span class=cl><span class=sd>            --allow-unauthenticated \
</span></span></span><span class=line><span class=cl><span class=sd>            --project timengledev-blog \
</span></span></span><span class=line><span class=cl><span class=sd>            --max-instances=4</span><span class=w>          
</span></span></span></code></pre></div><p>When ever updates are pushed to the <code>main</code> branch the following will happen.</p><ol><li>An instance of the latest ubuntu will be spun up on a remote machine.</li><li>The code from the main branch will be checked out into this machine.</li><li>Go will be set up.</li><li>The build script created in he previous section will execute and create our binary that runs the application.</li><li>The machine will be authenticated with GCP using our Service Account.</li><li><code>gcloud</code> will be set up and run</li><li>A new Image containing the updated binary will be built and pushed to the Artifact Registry</li><li>Cloud Run will deploy an updated container using the updated image that was just built and pushed to the Artifact Registry.</li></ol><hr><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Now that we have a fully automated CD pipeline in place we will have more time free to focus on creating new features and fixing bugs. We will no longer need to manually build, upload, and deploy production code manually to GCP as all of this will be handled by our pipeline.</p><p>In the future we will look into monitoring containers, optimizing performance, and scaling as applications grow. This is just the beginning of creating a robust, scalable, and automated infrastructure for your Go containers.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/a-simple-guide-to-name-resolution/><span class=title>« Prev</span><br><span>A Simple Guide to Name Resolution</span>
</a><a class=next href=http://localhost:1313/posts/gcp-continuous-deployment-2/><span class=title>Next »</span><br><span>Continuous Deployment: Creating a GitHub Workflow, Build Script, and Dockerfile</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run on x" href="https://x.com/intent/tweet/?text=Continuous%20Deployment%3a%20Automating%20GCP%20Deployments%20with%20Artifact%20Registry%20and%20Cloud%20Run&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f&amp;title=Continuous%20Deployment%3a%20Automating%20GCP%20Deployments%20with%20Artifact%20Registry%20and%20Cloud%20Run&amp;summary=Continuous%20Deployment%3a%20Automating%20GCP%20Deployments%20with%20Artifact%20Registry%20and%20Cloud%20Run&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f&title=Continuous%20Deployment%3a%20Automating%20GCP%20Deployments%20with%20Artifact%20Registry%20and%20Cloud%20Run"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run on whatsapp" href="https://api.whatsapp.com/send?text=Continuous%20Deployment%3a%20Automating%20GCP%20Deployments%20with%20Artifact%20Registry%20and%20Cloud%20Run%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run on telegram" href="https://telegram.me/share/url?text=Continuous%20Deployment%3a%20Automating%20GCP%20Deployments%20with%20Artifact%20Registry%20and%20Cloud%20Run&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Continuous Deployment: Automating GCP Deployments with Artifact Registry and Cloud Run on ycombinator" href="https://news.ycombinator.com/submitlink?t=Continuous%20Deployment%3a%20Automating%20GCP%20Deployments%20with%20Artifact%20Registry%20and%20Cloud%20Run&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fgcp-continuous-deployment-3%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Tim Engle Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>